<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Apple Products</title>

    <!-- Bootstrap 5 CDN -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>

  <body class="bg-light">
    <div class="container py-5">
      <h1 class="text-center mb-5 text-primary fw-bold">
        Apple Product Management
      </h1>

      <!-- Add Product Form -->
      <div class="card shadow mb-5">
        <div class="card-body">
          <h3 class="card-title text-center mb-4 text-success">Add Product</h3>

          <form action="http://localhost:1234/add-product" method="post">
            <div class="row g-4">
              <!-- Product Info -->
              <div class="col-md-6">
                <h5 class="text-secondary">Product Details</h5>
                <div class="mb-3">
                  <label class="form-label">Product Name</label>
                  <input
                    type="text"
                    name="product_name"
                    class="form-control"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label class="form-label">Product URL</label>
                  <input
                    type="text"
                    name="product_url"
                    class="form-control"
                    required
                  />
                </div>
              </div>

              <!-- Description -->
              <div class="col-md-6">
                <h5 class="text-secondary">Product Description</h5>
                <div class="mb-3">
                  <label class="form-label">Brief Description</label>
                  <textarea
                    name="product_brief_description"
                    class="form-control"
                    rows="3"
                    required
                  ></textarea>
                </div>
                <div class="mb-3">
                  <label class="form-label">Full Description</label>
                  <textarea
                    name="product_description"
                    class="form-control"
                    rows="3"
                    required
                  ></textarea>
                </div>
                <div class="mb-3">
                  <label class="form-label">Image URL</label>
                  <input
                    type="text"
                    name="product_img"
                    class="form-control"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label class="form-label">Product Link</label>
                  <input
                    type="text"
                    name="product_link"
                    class="form-control"
                    required
                  />
                </div>
              </div>

              <!-- Price Info -->
              <div class="col-md-6">
                <h5 class="text-secondary">Pricing</h5>
                <div class="mb-3">
                  <label class="form-label">Starting Price</label>
                  <input
                    type="text"
                    name="starting_price"
                    class="form-control"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label class="form-label">Price Range</label>
                  <input
                    type="text"
                    name="price_range"
                    class="form-control"
                    required
                  />
                </div>
              </div>

              <!-- User Info -->
              <div class="col-md-6">
                <h5 class="text-secondary">User Info</h5>
                <div class="mb-3">
                  <label class="form-label">User Name</label>
                  <input
                    type="text"
                    name="user_name"
                    class="form-control"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label class="form-label">User Password</label>
                  <input
                    type="password"
                    name="user_password"
                    class="form-control"
                    required
                  />
                </div>
              </div>
            </div>

            <div class="text-center mt-4">
              <button type="submit" class="btn btn-primary px-5">
                Add Product
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Delete Form -->
      <div class="card shadow">
        <div class="card-body">
          <h3 class="card-title text-center text-danger mb-4">
            Delete Product
          </h3>

          <span id="deleteMessage" class="mt-3"></span>

          <form
            action="http://localhost:1234/delete"
            method="post"
            class="text-center"
            id="deleteForm"
          >
            <div class="mb-3">
              <label class="form-label">Product ID</label>
              <input
                type="text"
                name="delete_id"
                class="form-control w-50 mx-auto"
                required
              />
            </div>
            <button type="submit" class="btn btn-outline-danger px-4">
              Delete
            </button>
          </form>
        </div>
      </div>
    </div>

    <!--  Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      const deleteMessage = document.getElementById("deleteMessage");
      const deleteForm = document.getElementById("deleteForm");

      deleteForm.addEventListener("submit", async (e) => {
        e.preventDefault();

        const formData = new URLSearchParams( new FormData(deleteForm))
        try {
          const res = await fetch("http://localhost:1234/delete", {
            method: "POST",
            body: formData,
            headers: {
      "Content-Type": "application/x-www-form-urlencoded",
    },
          });

          if (res.ok) {
            // deleteMessage.innerText='Product deleted successfully'
            deleteMessage.innerHTML =
              '<div class="alert alert-success">Product deleted successfully </div>';
            deleteForm.reset();
          } else {
            deleteMessage.innerHTML =
              '<div class="alert alert-danger">Failed to delete product </div>';
          }
        } catch (error) {
          deleteMessage.innerHTML= `<div class="alert alert-danger">Error: ${error.message}</div>`        }
      });
    </script>
  </body>
</html>